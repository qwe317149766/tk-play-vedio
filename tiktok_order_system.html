<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTokæœåŠ¡ä¸‹å•ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            margin-right: 10px;
            border-radius: 2px;
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .service-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .service-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .service-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .service-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .service-card .name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .service-card .price {
            color: #667eea;
            font-weight: 600;
            font-size: 14px;
        }

        .service-card .loading {
            color: #999;
            font-size: 12px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input[type="file"] {
            padding: 10px;
            background: #f8f9fa;
            cursor: pointer;
        }

        .input-group input[type="file"]:hover {
            background: #e9ecef;
        }

        .input-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group .hint {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .summary-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .card-query-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .card-query-actions .btn {
            width: 100%;
        }

        .card-query-result {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
        }

        .card-query-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .card-query-stat {
            background: white;
            border-radius: 10px;
            padding: 12px;
            border: 1px solid #e0e0e0;
        }

        .card-query-stat .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
        }

        .card-query-stat .value {
            font-size: 20px;
            font-weight: 600;
            color: #667eea;
        }

        .card-query-orders-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .card-query-orders-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .card-order-row {
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }

        .card-order-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .card-order-meta {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
        }

        .card-query-placeholder {
            font-size: 12px;
            color: #999;
            text-align: center;
        }

        .summary-row.total {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            border-top: 2px solid #e0e0e0;
            padding-top: 10px;
            margin-top: 10px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 20px;
            color: #333;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
        }

        .modal-footer .btn {
            flex: 1;
        }

        /* æˆåŠŸé¡µé¢ */
        .success-page {
            text-align: center;
            padding: 40px 20px;
        }

        .success-icon {
            font-size: 80px;
            color: #28a745;
            margin-bottom: 20px;
        }

        .success-page h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .success-page p {
            color: #666;
            margin-bottom: 30px;
        }

        .order-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .order-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        /* è¿›åº¦é¡µé¢ */
        .progress-page {
            padding: 20px;
        }

        .order-list {
            margin-top: 20px;
        }

        .order-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .order-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .order-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .order-item-title {
            font-weight: 600;
            color: #333;
        }

        .order-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .order-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .order-status.processing {
            background: #cfe2ff;
            color: #084298;
        }

        .order-status.completed {
            background: #d1e7dd;
            color: #0f5132;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 12px;
            color: #666;
            text-align: right;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* å“åº”å¼ */
        @media (max-width: 600px) {
            .service-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸»é¡µé¢ -->
        <div id="mainPage">
            <div class="header">
                <h1>ğŸµ TikTokæœåŠ¡ä¸‹å•ç³»ç»Ÿ</h1>
                <p>ä¸“ä¸šã€å¿«é€Ÿã€å®‰å…¨çš„TikTokå¢å€¼æœåŠ¡</p>
            </div>

            <div class="content">
                <!-- æœåŠ¡é€‰æ‹© -->
                <div class="section">
                    <div class="section-title">é€‰æ‹©æœåŠ¡ç±»å‹</div>
                    <div class="service-grid" id="serviceGrid">
                        <!-- åŠ¨æ€åŠ è½½æœåŠ¡å¡ç‰‡ -->
                    </div>
                </div>

                <!-- æ’­æ”¾æœåŠ¡é…ç½® -->
                <div class="section" id="playConfig" style="display: none;">
                    <div class="section-title">æ’­æ”¾ä»»åŠ¡é…ç½®</div>
                    
                    <div class="input-group">
                        <label for="videoIdsInput">è§†é¢‘IDåˆ—è¡¨ï¼ˆç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ TXTæ–‡ä»¶ï¼‰</label>
                        <textarea id="videoIdsInput" rows="5" placeholder="æ¯è¡Œä¸€ä¸ªè§†é¢‘IDï¼Œä¾‹å¦‚ï¼š&#10;7569608169052212501&#10;7569608169052212502&#10;7569608169052212503"></textarea>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="file" id="videoIdsFile" accept=".txt" style="display: none;">
                            <button type="button" onclick="document.getElementById('videoIdsFile').click()" style="flex: 1; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ“ ä¸Šä¼ TXTæ–‡ä»¶</button>
                            <button type="button" onclick="document.getElementById('videoIdsInput').value = ''" style="flex: 1; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ—‘ï¸ æ¸…ç©º</button>
                        </div>
                        <div class="hint" id="videoCountHint">è¯·ç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªè§†é¢‘ID</div>
                    </div>

                    <div class="input-group">
                        <label for="playCountPerVideo">æ¯ä¸ªè§†é¢‘è®¢å•æ•°é‡ï¼ˆæ¯å•=1000æ¬¡æ’­æ”¾ï¼‰</label>
                        <input type="number" id="playCountPerVideo" min="1" step="1" value="1" placeholder="ä¾‹å¦‚ï¼š5 è¡¨ç¤º5000æ¬¡æ’­æ”¾">
                        <div class="hint">è®¢å•ä»¥1000æ¬¡æ’­æ”¾ä¸ºå•ä½ï¼Œè¯·è¾“å…¥æ•´æ•°è®¢å•æ•°</div>
                    </div>
                </div>

                <!-- ç‚¹èµæœåŠ¡é…ç½® -->
                <div class="section" id="likeConfig" style="display: none;">
                    <div class="section-title">ç‚¹èµä»»åŠ¡é…ç½®</div>
                    
                    <div class="input-group">
                        <label for="likeVideoIdsInput">å¾…ç‚¹èµè§†é¢‘IDåˆ—è¡¨ï¼ˆç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ TXTæ–‡ä»¶ï¼‰</label>
                        <textarea id="likeVideoIdsInput" rows="5" placeholder="æ¯è¡Œä¸€ä¸ªè§†é¢‘IDï¼Œä¾‹å¦‚ï¼š&#10;7569608169052212501&#10;7569608169052212502"></textarea>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="file" id="likeVideoIdsFile" accept=".txt" style="display: none;">
                            <button type="button" onclick="document.getElementById('likeVideoIdsFile').click()" style="flex: 1; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ“ ä¸Šä¼ TXTæ–‡ä»¶</button>
                            <button type="button" onclick="document.getElementById('likeVideoIdsInput').value = ''" style="flex: 1; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ—‘ï¸ æ¸…ç©º</button>
                        </div>
                        <div class="hint" id="likeVideoCountHint">è¯·ç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªè§†é¢‘ID</div>
                    </div>

                    <div class="input-group">
                        <label for="likeCountPerVideo">æ¯ä¸ªè§†é¢‘ç‚¹èµæ•°é‡</label>
                        <input type="number" id="likeCountPerVideo" min="100" step="100" value="1000" placeholder="ä¾‹å¦‚ï¼š1000">
                        <div class="hint">å»ºè®®æŒ‰1000ä¸ºå•ä½ï¼Œä¾‹å¦‚ï¼š1000ã€2000ã€3000</div>
                    </div>
                </div>

                <!-- è¯„è®ºæœåŠ¡é…ç½® -->
                <div class="section" id="commentConfig" style="display: none;">
                    <div class="section-title">è¯„è®ºä»»åŠ¡é…ç½®</div>
                    
                    <div class="input-group">
                        <label for="commentVideoIdsInput">å¾…è¯„è®ºè§†é¢‘IDåˆ—è¡¨ï¼ˆç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ TXTæ–‡ä»¶ï¼‰</label>
                        <textarea id="commentVideoIdsInput" rows="5" placeholder="æ¯è¡Œä¸€ä¸ªè§†é¢‘IDï¼Œä¾‹å¦‚ï¼š&#10;7569608169052212501&#10;7569608169052212502"></textarea>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="file" id="commentVideoIdsFile" accept=".txt" style="display: none;">
                            <button type="button" onclick="document.getElementById('commentVideoIdsFile').click()" style="flex: 1; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ“ ä¸Šä¼ TXTæ–‡ä»¶</button>
                            <button type="button" onclick="document.getElementById('commentVideoIdsInput').value = ''" style="flex: 1; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ—‘ï¸ æ¸…ç©º</button>
                        </div>
                        <div class="hint">è¯·ç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªè§†é¢‘ID</div>
                    </div>

                    <div class="input-group">
                        <label for="commentCountPerVideo">æ¯ä¸ªè§†é¢‘è¯„è®ºæ•°é‡</label>
                        <input type="number" id="commentCountPerVideo" min="100" step="100" value="1000" placeholder="ä¾‹å¦‚ï¼š1000">
                        <div class="hint">å»ºè®®æŒ‰1000ä¸ºå•ä½ï¼Œä¾‹å¦‚ï¼š1000ã€2000ã€3000</div>
                    </div>

                    <div class="input-group">
                        <label for="commentTemplatesInput">è¯„è®ºæ¨¡æ¿åˆ—è¡¨ï¼ˆç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ TXTæ–‡ä»¶ï¼‰</label>
                        <textarea id="commentTemplatesInput" rows="6" placeholder="æ¯è¡Œä¸€æ¡è¯„è®ºæ¨¡æ¿ï¼Œä¾‹å¦‚ï¼š&#10;å¾ˆæ£’çš„è§†é¢‘ï¼&#10;å¤ªç²¾å½©äº†ï¼&#10;å–œæ¬¢è¿™ä¸ªå†…å®¹"></textarea>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="file" id="commentTemplatesFile" accept=".txt" style="display: none;">
                            <button type="button" onclick="document.getElementById('commentTemplatesFile').click()" style="flex: 1; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ“ ä¸Šä¼ TXTæ–‡ä»¶</button>
                            <button type="button" onclick="document.getElementById('commentTemplatesInput').value = ''" style="flex: 1; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ—‘ï¸ æ¸…ç©º</button>
                        </div>
                        <div class="hint">ç³»ç»Ÿä¼šéšæœºé€‰æ‹©æ¨¡æ¿è¿›è¡Œè¯„è®º</div>
                    </div>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="commentAddEmoji" checked>
                            éšæœºæ·»åŠ è¡¨æƒ…åç¼€
                        </label>
                        <div class="hint">ä¾‹å¦‚ï¼šå¾ˆæ£’çš„è§†é¢‘ ğŸ‘ã€å–œæ¬¢ â¤ï¸ã€å¤ªå¥½äº† ğŸ‰</div>
                    </div>
                </div>

                <!-- ç§ä¿¡æœåŠ¡é…ç½® -->
                <div class="section" id="followConfig" style="display: none;">
                    <div class="section-title">ç§ä¿¡ä»»åŠ¡é…ç½®</div>
                    
                    <div class="input-group">
                        <label for="targetUsersInput">å¾…ç§ä¿¡ç”¨æˆ·åˆ—è¡¨ï¼ˆç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ TXTæ–‡ä»¶ï¼‰</label>
                        <textarea id="targetUsersInput" rows="5" placeholder="æ¯è¡Œä¸€ä¸ªç”¨æˆ·åæˆ–ç”¨æˆ·IDï¼Œä¾‹å¦‚ï¼š&#10;@username&#10;123456789&#10;@anotheruser"></textarea>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <input type="file" id="targetUsersFile" accept=".txt" style="display: none;">
                            <button type="button" onclick="document.getElementById('targetUsersFile').click()" style="flex: 1; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ“ ä¸Šä¼ TXTæ–‡ä»¶</button>
                            <button type="button" onclick="document.getElementById('targetUsersInput').value = ''" style="flex: 1; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ—‘ï¸ æ¸…ç©º</button>
                        </div>
                        <div class="hint" id="targetUsersCountHint">è¯·ç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªç”¨æˆ·</div>
                    </div>

                    <div class="input-group">
                        <label for="messageContent">ç§ä¿¡æ–‡æœ¬å†…å®¹</label>
                        <textarea id="messageContent" rows="4" placeholder="è¾“å…¥è¦å‘é€çš„ç§ä¿¡å†…å®¹..."></textarea>
                        <div class="hint">æ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼Œå¯ä»¥ä½¿ç”¨å˜é‡ï¼š{username} = ç”¨æˆ·å</div>
                    </div>

                    <div class="input-group">
                        <label>
                            <input type="checkbox" id="messageAddRandomEmoji" checked>
                            éšæœºæ·»åŠ è¡¨æƒ…åç¼€
                        </label>
                        <div class="hint">ç³»ç»Ÿä¼šä»å¸¸ç”¨è¡¨æƒ…ä¸­éšæœºé€‰æ‹©1-3ä¸ªæ·»åŠ åˆ°æ¶ˆæ¯æœ«å°¾</div>
                    </div>

                    <div class="input-group">
                        <label for="messageEmojis">è‡ªå®šä¹‰è¡¨æƒ…ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="messageEmojis" placeholder="ä¾‹å¦‚ï¼šğŸ˜Š,â¤ï¸,ğŸ‘,ğŸ‰,âœ¨">
                        <div class="hint">ç”¨é€—å·åˆ†éš”å¤šä¸ªè¡¨æƒ…ï¼Œç•™ç©ºåˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤</div>
                    </div>
                </div>

                <!-- å¤‡æ³¨ -->
                <div class="section">
                    <div class="input-group">
                        <label for="remark">å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰</label>
                        <textarea id="remark" rows="3" placeholder="è¾“å…¥è®¢å•å¤‡æ³¨ä¿¡æ¯"></textarea>
                    </div>
                </div>

                <!-- å¡å¯†ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="section" id="cardStatsSection" style="display: none;">
                    <div class="section-title">ğŸ’³ å¡å¯†ç»Ÿè®¡</div>
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">å·²å®Œæˆè®¢å•</div>
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="cardCompletedOrders">-</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">å·²ä½¿ç”¨é¢åº¦</div>
                            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;" id="cardUsedQuota">-</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 14px; color: #666; margin-bottom: 5px;">å‰©ä½™é¢åº¦</div>
                            <div style="font-size: 24px; font-weight: bold; color: #10b981;" id="cardRemainingQuota">-</div>
                        </div>
                    </div>
                    <div style="margin-top: 10px; text-align: center;">
                        <button type="button" onclick="refreshCardStats()" style="padding: 6px 16px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ”„ åˆ·æ–°ç»Ÿè®¡</button>
                    </div>
                </div>
                <div style="margin: -10px 0 10px; text-align: center;">
                    <button type="button" id="cardQueryToggleBtn" style="padding: 6px 16px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">ğŸ” å¡å¯†æŸ¥è¯¢</button>
                </div>

                <!-- å¡å¯†æŸ¥è¯¢ -->
                <div class="section hidden" id="cardQuerySection">
                    <div class="section-title">ğŸ” å¡å¯†æŸ¥è¯¢</div>
                    <div class="input-group">
                        <label for="cardQueryInput">æŸ¥è¯¢å¡å¯†</label>
                        <input type="text" id="cardQueryInput" placeholder="è¾“å…¥è¦æŸ¥è¯¢çš„å¡å¯†">
                        <div class="hint">æŸ¥è¯¢åå¯æŸ¥çœ‹è¯¥å¡å¯†å‰©ä½™ç§¯åˆ†åŠå…³è”è®¢å•</div>
                    </div>
                    <div class="card-query-actions">
                        <button type="button" class="btn btn-primary" id="cardQueryBtn">æŸ¥è¯¢å¡å¯†ä¿¡æ¯</button>
                        <button type="button" class="btn btn-secondary" id="cardQueryResetBtn">æ¸…ç©º</button>
                    </div>
                    <div class="card-query-result hidden" id="cardQueryResult">
                        <div class="card-query-stats" id="cardQueryStats">
                            <p class="card-query-placeholder">è¯·å…ˆè¾“å…¥å¡å¯†è¿›è¡ŒæŸ¥è¯¢</p>
                        </div>
                        <div class="card-query-orders">
                            <div class="card-query-orders-title">å…³è”è®¢å•</div>
                            <div class="card-query-orders-list" id="cardQueryOrdersList">
                                <p class="card-query-placeholder">æš‚æ— æ•°æ®</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®¢å•æ‘˜è¦ -->
                <div class="summary-box">
                    <div class="summary-row">
                        <span>æœåŠ¡ç±»å‹ï¼š</span>
                        <span id="summaryService">æœªé€‰æ‹©</span>
                    </div>
                    <div class="summary-row">
                        <span>å•ä»·ï¼š</span>
                        <span id="summaryUnitPrice">-</span>
                    </div>
                    <div class="summary-row">
                        <span>æ•°é‡ï¼š</span>
                        <span id="summaryQuantity">0 å•ä½</span>
                    </div>
                    <div class="summary-row total">
                        <span>æ€»è®¡ï¼š</span>
                        <span id="summaryTotal">0 USDT</span>
                    </div>
                </div>

                <!-- ä¸‹å•æŒ‰é’® -->
                <button class="btn btn-primary" id="submitOrderBtn" disabled>
                    ç«‹å³ä¸‹å•
                </button>

                <button class="btn btn-secondary" id="viewProgressBtn">
                    æŸ¥çœ‹è®¢å•è¿›åº¦
                </button>
            </div>
        </div>

        <!-- è®¢å•è¿›åº¦é¡µé¢ -->
        <div id="progressPage" class="hidden">
            <div class="header">
                <h1>ğŸ“Š è®¢å•è¿›åº¦æŸ¥è¯¢</h1>
                <p>å®æ—¶æŸ¥çœ‹æ‚¨çš„è®¢å•å®Œæˆæƒ…å†µ</p>
            </div>

            <div class="content progress-page">
                <button class="btn btn-secondary" id="backToMainBtn">
                    è¿”å›ä¸‹å•
                </button>

                <!-- è®¢å•å·æŸ¥è¯¢ -->
                <div class="section">
                    <div class="section-title">ğŸ” è®¢å•å·æŸ¥è¯¢</div>
                    <div style="display: flex; gap: 10px; align-items: flex-end;">
                        <div class="input-group" style="flex: 1; margin-bottom: 0;">
                            <label for="searchOrderId">è¾“å…¥è®¢å•å·</label>
                            <input type="text" id="searchOrderId" placeholder="ä¾‹å¦‚ï¼šORD20231117001">
                        </div>
                        <button type="button" onclick="searchOrderById()" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; white-space: nowrap; height: 46px;">
                            ğŸ” æŸ¥è¯¢
                        </button>
                        <button type="button" onclick="loadAllOrders()" style="padding: 12px 24px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; white-space: nowrap; height: 46px;">
                            ğŸ“‹ å…¨éƒ¨è®¢å•
                        </button>
                    </div>
                </div>

                <!-- è®¢å•åˆ—è¡¨ -->
                <div class="section">
                    <div class="section-title">ğŸ“¦ è®¢å•åˆ—è¡¨</div>
                    <div class="order-list" id="orderList">
                        <!-- åŠ¨æ€åŠ è½½è®¢å•åˆ—è¡¨ -->
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <p>è¯·è¾“å…¥è®¢å•å·æŸ¥è¯¢ï¼Œæˆ–ç‚¹å‡»"å…¨éƒ¨è®¢å•"æŸ¥çœ‹æ‰€æœ‰è®¢å•</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤ä¸‹å•æ¨¡æ€æ¡† -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç¡®è®¤ä¸‹å•ä¿¡æ¯</h3>
            </div>
            <div class="modal-body">
                <div class="order-info">
                    <div class="order-info-row">
                        <span>æœåŠ¡ç±»å‹ï¼š</span>
                        <strong id="confirmService"></strong>
                    </div>
                    <div class="order-info-row">
                        <span>è§†é¢‘é“¾æ¥ï¼š</span>
                        <strong id="confirmUrl" style="word-break: break-all; font-size: 12px;"></strong>
                    </div>
                    <div class="order-info-row">
                        <span>æ•°é‡ï¼š</span>
                        <strong id="confirmQuantity"></strong>
                    </div>
                    <div class="order-info-row">
                        <span>å•ä»·ï¼š</span>
                        <strong id="confirmUnitPrice"></strong>
                    </div>
                    <div class="order-info-row" style="border-top: 2px solid #e0e0e0; padding-top: 10px; margin-top: 10px;">
                        <span>æ€»è®¡ï¼š</span>
                        <strong style="color: #667eea; font-size: 18px;" id="confirmTotal"></strong>
                    </div>
                </div>

                <div class="input-group">
                    <label for="cardKey">å¡å¯†</label>
                    <input type="text" id="cardKey" placeholder="è¯·è¾“å…¥å¡å¯†">
                    <div class="hint">é¦–æ¬¡ä¸‹å•éœ€è¦è¾“å…¥å¡å¯†ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®°ä½</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelOrderBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="confirmOrderBtn">ç¡®è®¤ä¸‹å•</button>
            </div>
        </div>
    </div>

    <!-- ä¸‹å•æˆåŠŸæ¨¡æ€æ¡† -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-body success-page">
                <div class="success-icon">âœ…</div>
                <h2>ä¸‹å•æˆåŠŸï¼</h2>
                <p>æ‚¨çš„è®¢å•å·²æäº¤ï¼Œç³»ç»Ÿæ­£åœ¨å¤„ç†ä¸­</p>

                <div class="order-info">
                    <div class="order-info-row">
                        <span>è®¢å•ç¼–å·ï¼š</span>
                        <strong id="successOrderId"></strong>
                    </div>
                    <div class="order-info-row">
                        <span>æœåŠ¡ç±»å‹ï¼š</span>
                        <strong id="successService"></strong>
                    </div>
                    <div class="order-info-row">
                        <span>ä¸‹å•æ•°é‡ï¼š</span>
                        <strong id="successQuantity"></strong>
                    </div>
                    <div class="order-info-row">
                        <span>æ”¯ä»˜é‡‘é¢ï¼š</span>
                        <strong id="successAmount"></strong>
                    </div>
                </div>

                <button class="btn btn-primary" id="viewOrderBtn">æŸ¥çœ‹è®¢å•è¿›åº¦</button>
                <button class="btn btn-secondary" id="continueOrderBtn">ç»§ç»­ä¸‹å•</button>
            </div>
        </div>
    </div>

    <script>
        // API é…ç½®
        const API_BASE_URL = 'http://localhost:8000/api'; // ä¿®æ”¹ä¸ºå®é™…çš„APIåœ°å€

        // æœåŠ¡ç±»å‹é…ç½®
        const SERVICE_TYPES = {
            play: { name: 'TikTokæ’­æ”¾', icon: 'â–¶ï¸', unit: '1000æ¬¡æ’­æ”¾', key: 'play' },
            like: { name: 'TikTokç‚¹èµ', icon: 'â¤ï¸', unit: '1000ä¸ª', key: 'like' },
            comment: { name: 'TikTokè¯„è®º', icon: 'ğŸ’¬', unit: '1000æ¡', key: 'comment' },
            follow: { name: 'TikTokç§ä¿¡', icon: 'ğŸ’Œ', unit: '1000æ¡', key: 'follow' },
        };

        // å…¨å±€çŠ¶æ€
        let currentState = {
            selectedService: null,
            servicePrices: {},
            remark: '',
            cardKey: localStorage.getItem('cardKey') || '',
            // æ’­æ”¾é…ç½®
            playConfig: {
                videoIds: [],
                orderQuantityPerVideo: 1
            },
            // ç‚¹èµé…ç½®
            likeConfig: {
                videoIds: [],
                likeCountPerVideo: 1000
            },
            // è¯„è®ºé…ç½®
            commentConfig: {
                videoIds: [],
                commentCountPerVideo: 1000,
                commentTemplates: [],
                addEmoji: true
            },
            // ç§ä¿¡é…ç½®
            followConfig: {
                targetUsers: [],
                messageContent: '',
                addRandomEmoji: true,
                customEmojis: []
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            initServiceCards();
            bindEvents();
            loadCardKey();
        });

        // åˆå§‹åŒ–æœåŠ¡å¡ç‰‡
        async function initServiceCards() {
            const serviceGrid = document.getElementById('serviceGrid');
            serviceGrid.innerHTML = '';

            for (const [key, service] of Object.entries(SERVICE_TYPES)) {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.dataset.service = key;
                card.innerHTML = `
                    <div class="icon">${service.icon}</div>
                    <div class="name">${service.name}</div>
                    <div class="price loading">åŠ è½½ä»·æ ¼ä¸­...</div>
                `;
                card.onclick = () => selectService(key);
                serviceGrid.appendChild(card);
            }

            // åŠ è½½ä»·æ ¼
            await loadPrices();
        }

        // åŠ è½½ä»·æ ¼
        async function loadPrices() {
            try {
                const response = await fetch(`${API_BASE_URL}/prices`);
                const result = await response.json();

                if (result.code === 0) {
                    currentState.servicePrices = result.data;

                    // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
                    for (const [key, price] of Object.entries(result.data)) {
                        const card = document.querySelector(`[data-service="${key}"]`);
                        if (card) {
                            const priceElement = card.querySelector('.price');
                            priceElement.textContent = `${price} USDT/${SERVICE_TYPES[key].unit}`;
                            priceElement.classList.remove('loading');
                        }
                    }
                } else {
                    console.error('åŠ è½½ä»·æ ¼å¤±è´¥:', result.msg);
                    // ä½¿ç”¨é»˜è®¤ä»·æ ¼
                    currentState.servicePrices = {
                        play: 1.0,
                        like: 2.0,
                        comment: 3.0,
                        follow: 2.5
                    };
                    updatePriceDisplay();
                }
            } catch (error) {
                console.error('åŠ è½½ä»·æ ¼å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤ä»·æ ¼
                currentState.servicePrices = {
                    play: 1.0,
                    like: 2.0,
                    comment: 3.0,
                    follow: 2.5
                };
                updatePriceDisplay();
            }
        }

        // æ›´æ–°ä»·æ ¼æ˜¾ç¤ºï¼ˆä½¿ç”¨é»˜è®¤ä»·æ ¼ï¼‰
        function updatePriceDisplay() {
            for (const [key, price] of Object.entries(currentState.servicePrices)) {
                const card = document.querySelector(`[data-service="${key}"]`);
                if (card) {
                    const priceElement = card.querySelector('.price');
                    priceElement.textContent = `${price} USDT/${SERVICE_TYPES[key].unit}`;
                    priceElement.classList.remove('loading');
                }
            }
        }

        // é€‰æ‹©æœåŠ¡
        function selectService(serviceKey) {
            // ç§»é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });

            // æ·»åŠ é€‰ä¸­çŠ¶æ€
            const selectedCard = document.querySelector(`[data-service="${serviceKey}"]`);
            selectedCard.classList.add('selected');

            currentState.selectedService = serviceKey;

            // éšè—æ‰€æœ‰é…ç½®åŒºåŸŸ
            document.getElementById('playConfig').style.display = 'none';
            document.getElementById('likeConfig').style.display = 'none';
            document.getElementById('commentConfig').style.display = 'none';
            document.getElementById('followConfig').style.display = 'none';

            // æ˜¾ç¤ºå¯¹åº”çš„é…ç½®åŒºåŸŸ
            if (serviceKey === 'play') {
                document.getElementById('playConfig').style.display = 'block';
            } else if (serviceKey === 'like') {
                document.getElementById('likeConfig').style.display = 'block';
            } else if (serviceKey === 'comment') {
                document.getElementById('commentConfig').style.display = 'block';
            } else if (serviceKey === 'follow') {
                document.getElementById('followConfig').style.display = 'block';
            }

            updateSummary();
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // å¤‡æ³¨å˜åŒ–
            document.getElementById('remark').addEventListener('input', (e) => {
                currentState.remark = e.target.value.trim();
            });

            // ========== æ’­æ”¾æœåŠ¡äº‹ä»¶ ==========
            document.getElementById('videoIdsFile').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const content = await readTextFile(file);
                    const videoIds = content.split('\n').map(id => id.trim()).filter(id => id.length > 0);
                    document.getElementById('videoIdsInput').value = videoIds.join('\n');
                    currentState.playConfig.videoIds = videoIds;
                    document.getElementById('videoCountHint').textContent = `å·²ä¸Šä¼  ${videoIds.length} ä¸ªè§†é¢‘ID`;
                    updateSummary();
                    e.target.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©ï¼Œå…è®¸é‡å¤ä¸Šä¼ åŒä¸€æ–‡ä»¶
                }
            });

            document.getElementById('videoIdsInput').addEventListener('input', (e) => {
                const videoIds = e.target.value.split('\n').map(id => id.trim()).filter(id => id.length > 0);
                currentState.playConfig.videoIds = videoIds;
                document.getElementById('videoCountHint').textContent = videoIds.length > 0 ? 
                    `å·²è¾“å…¥ ${videoIds.length} ä¸ªè§†é¢‘ID` : 'è¯·ç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªè§†é¢‘ID';
                updateSummary();
            });

            document.getElementById('playCountPerVideo').addEventListener('input', (e) => {
                currentState.playConfig.orderQuantityPerVideo = Math.max(1, parseInt(e.target.value) || 1);
                document.getElementById('playCountPerVideo').value = currentState.playConfig.orderQuantityPerVideo;
                updateSummary();
            });

            // ========== ç‚¹èµæœåŠ¡äº‹ä»¶ ==========
            document.getElementById('likeVideoIdsFile').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const content = await readTextFile(file);
                    const videoIds = content.split('\n').map(id => id.trim()).filter(id => id.length > 0);
                    document.getElementById('likeVideoIdsInput').value = videoIds.join('\n');
                    currentState.likeConfig.videoIds = videoIds;
                    document.getElementById('likeVideoCountHint').textContent = `å·²ä¸Šä¼  ${videoIds.length} ä¸ªè§†é¢‘ID`;
                    updateSummary();
                    e.target.value = '';
                }
            });

            document.getElementById('likeVideoIdsInput').addEventListener('input', (e) => {
                const videoIds = e.target.value.split('\n').map(id => id.trim()).filter(id => id.length > 0);
                currentState.likeConfig.videoIds = videoIds;
                document.getElementById('likeVideoCountHint').textContent = videoIds.length > 0 ? 
                    `å·²è¾“å…¥ ${videoIds.length} ä¸ªè§†é¢‘ID` : 'è¯·ç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªè§†é¢‘ID';
                updateSummary();
            });

            document.getElementById('likeCountPerVideo').addEventListener('input', (e) => {
                currentState.likeConfig.likeCountPerVideo = parseInt(e.target.value) || 1000;
                updateSummary();
            });

            // ========== è¯„è®ºæœåŠ¡äº‹ä»¶ ==========
            document.getElementById('commentVideoIdsFile').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const content = await readTextFile(file);
                    const videoIds = content.split('\n').map(id => id.trim()).filter(id => id.length > 0);
                    document.getElementById('commentVideoIdsInput').value = videoIds.join('\n');
                    currentState.commentConfig.videoIds = videoIds;
                    updateSummary();
                    e.target.value = '';
                }
            });

            document.getElementById('commentVideoIdsInput').addEventListener('input', (e) => {
                const videoIds = e.target.value.split('\n').map(id => id.trim()).filter(id => id.length > 0);
                currentState.commentConfig.videoIds = videoIds;
                updateSummary();
            });

            document.getElementById('commentCountPerVideo').addEventListener('input', (e) => {
                currentState.commentConfig.commentCountPerVideo = parseInt(e.target.value) || 1000;
                updateSummary();
            });

            document.getElementById('commentTemplatesFile').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const content = await readTextFile(file);
                    const templates = content.split('\n').map(t => t.trim()).filter(t => t.length > 0);
                    document.getElementById('commentTemplatesInput').value = templates.join('\n');
                    currentState.commentConfig.commentTemplates = templates;
                    e.target.value = '';
                }
            });

            document.getElementById('commentTemplatesInput').addEventListener('input', (e) => {
                const templates = e.target.value.split('\n').map(t => t.trim()).filter(t => t.length > 0);
                currentState.commentConfig.commentTemplates = templates;
            });

            document.getElementById('commentAddEmoji').addEventListener('change', (e) => {
                currentState.commentConfig.addEmoji = e.target.checked;
            });

            // ========== ç§ä¿¡æœåŠ¡äº‹ä»¶ ==========
            document.getElementById('targetUsersFile').addEventListener('change', async (e) => {
                const file = e.target.files[0];
                if (file) {
                    const content = await readTextFile(file);
                    const users = content.split('\n').map(u => u.trim()).filter(u => u.length > 0);
                    document.getElementById('targetUsersInput').value = users.join('\n');
                    currentState.followConfig.targetUsers = users;
                    document.getElementById('targetUsersCountHint').textContent = `å·²ä¸Šä¼  ${users.length} ä¸ªç”¨æˆ·`;
                    updateSummary();
                    e.target.value = '';
                }
            });

            document.getElementById('targetUsersInput').addEventListener('input', (e) => {
                const users = e.target.value.split('\n').map(u => u.trim()).filter(u => u.length > 0);
                currentState.followConfig.targetUsers = users;
                document.getElementById('targetUsersCountHint').textContent = users.length > 0 ? 
                    `å·²è¾“å…¥ ${users.length} ä¸ªç”¨æˆ·` : 'è¯·ç›´æ¥è¾“å…¥æˆ–ä¸Šä¼ æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªç”¨æˆ·';
                updateSummary();
            });

            document.getElementById('messageContent').addEventListener('input', (e) => {
                currentState.followConfig.messageContent = e.target.value.trim();
            });

            document.getElementById('messageAddRandomEmoji').addEventListener('change', (e) => {
                currentState.followConfig.addRandomEmoji = e.target.checked;
            });

            document.getElementById('messageEmojis').addEventListener('input', (e) => {
                const emojis = e.target.value.split(',').map(e => e.trim()).filter(e => e.length > 0);
                currentState.followConfig.customEmojis = emojis;
            });

            // ä¸‹å•æŒ‰é’®
            document.getElementById('submitOrderBtn').addEventListener('click', showConfirmModal);

            // æŸ¥çœ‹è¿›åº¦æŒ‰é’®
            document.getElementById('viewProgressBtn').addEventListener('click', showProgressPage);

            // è¿”å›ä¸»é¡µæŒ‰é’®
            document.getElementById('backToMainBtn').addEventListener('click', showMainPage);

            // å–æ¶ˆä¸‹å•
            document.getElementById('cancelOrderBtn').addEventListener('click', hideConfirmModal);

            // ç¡®è®¤ä¸‹å•
            document.getElementById('confirmOrderBtn').addEventListener('click', submitOrder);

            // æŸ¥çœ‹è®¢å•
            document.getElementById('viewOrderBtn').addEventListener('click', () => {
                hideSuccessModal();
                showProgressPage();
            });

            // ç»§ç»­ä¸‹å•
            document.getElementById('continueOrderBtn').addEventListener('click', () => {
                hideSuccessModal();
                resetForm();
            });

            document.getElementById('cardQueryToggleBtn').addEventListener('click', () => {
                document.getElementById('cardQuerySection').classList.remove('hidden');
                document.getElementById('cardQueryToggleBtn').style.display = 'none';
            });
            document.getElementById('cardQueryBtn').addEventListener('click', queryCardInfo);
            document.getElementById('cardQueryResetBtn').addEventListener('click', () => {
                document.getElementById('cardQueryInput').value = '';
                document.getElementById('cardQueryResult').classList.add('hidden');
            });
            document.getElementById('cardQueryInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    queryCardInfo();
                }
            });
        }

        // è¯»å–æ–‡æœ¬æ–‡ä»¶
        async function readTextFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsText(file, 'UTF-8');
            });
        }

        function setCardKey(cardKey) {
            currentState.cardKey = cardKey;
            document.getElementById('cardKey').value = cardKey;
            document.getElementById('cardQueryInput').value = cardKey;
            localStorage.setItem('cardKey', cardKey);
        }

        // åŠ è½½å¡å¯†
        function loadCardKey() {
            const savedCardKey = localStorage.getItem('cardKey');
            if (savedCardKey) {
                setCardKey(savedCardKey);
            }
        }

        // æ›´æ–°æ‘˜è¦
        function updateSummary() {
            const service = currentState.selectedService;

            if (!service || !SERVICE_TYPES[service]) {
                document.getElementById('summaryService').textContent = 'æœªé€‰æ‹©';
                document.getElementById('summaryUnitPrice').textContent = '-';
                document.getElementById('summaryQuantity').textContent = '0';
                document.getElementById('summaryTotal').textContent = '0 USDT';
                updateSubmitButton();
                return;
            }

            // è®¡ç®—ä¸åŒæœåŠ¡çš„æ•°é‡å’Œä»·æ ¼
            let totalTasks = 0;
            let totalVideos = 0;
            let totalUsers = 0;
            let quantityText = '0';

            if (service === 'play') {
                const videoCount = currentState.playConfig.videoIds.length;
                const orderQuantityPerVideo = currentState.playConfig.orderQuantityPerVideo;
                const playCountPerVideo = orderQuantityPerVideo * 1000;
                totalTasks = videoCount * playCountPerVideo;
                totalVideos = videoCount;
                quantityText = `${videoCount} ä¸ªè§†é¢‘ Ã— ${orderQuantityPerVideo} å•ï¼ˆæ¯å•1000æ¬¡æ’­æ”¾ï¼‰ = ${totalTasks} æ¬¡æ’­æ”¾`;
            } else if (service === 'like') {
                const videoCount = currentState.likeConfig.videoIds.length;
                const likeCountPerVideo = currentState.likeConfig.likeCountPerVideo;
                totalTasks = videoCount * likeCountPerVideo;
                totalVideos = videoCount;
                quantityText = `${videoCount} ä¸ªè§†é¢‘ Ã— ${likeCountPerVideo} ä¸ªç‚¹èµ`;
            } else if (service === 'comment') {
                const videoCount = currentState.commentConfig.videoIds.length;
                const commentCountPerVideo = currentState.commentConfig.commentCountPerVideo;
                totalTasks = videoCount * commentCountPerVideo;
                totalVideos = videoCount;
                quantityText = `${videoCount} ä¸ªè§†é¢‘ Ã— ${commentCountPerVideo} æ¡è¯„è®º`;
            } else if (service === 'follow') {
                totalUsers = currentState.followConfig.targetUsers.length;
                totalTasks = totalUsers;
                quantityText = `${totalUsers} ä¸ªç”¨æˆ·`;
            }

            document.getElementById('summaryService').textContent = SERVICE_TYPES[service].name;
            const unitPrice = currentState.servicePrices[service] || 0;
            document.getElementById('summaryUnitPrice').textContent = `${unitPrice} USDT/${SERVICE_TYPES[service].unit}`;
            document.getElementById('summaryQuantity').textContent = quantityText;
            
            // è®¡ç®—æ€»ä»·ï¼šæ ¹æ®ä»»åŠ¡æ€»æ•°è®¡ç®—
            let total = 0;
            if (service === 'play') {
                // æ’­æ”¾æŒ‰1000æ¬¡è®¡è´¹
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'like') {
                // ç‚¹èµæŒ‰1000ä¸ªè®¡è´¹
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'comment') {
                // è¯„è®ºæŒ‰1000æ¡è®¡è´¹
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'follow') {
                // ç§ä¿¡æŒ‰1000æ¡è®¡è´¹
                total = (totalTasks / 1000) * unitPrice;
            }
            
            document.getElementById('summaryTotal').textContent = `${total.toFixed(2)} USDT`;

            updateSubmitButton();
        }

        // æ›´æ–°æäº¤æŒ‰é’®çŠ¶æ€
        function updateSubmitButton() {
            const btn = document.getElementById('submitOrderBtn');
            let canSubmit = false;

            const service = currentState.selectedService;
            
            if (service === 'play') {
                canSubmit = currentState.playConfig.videoIds.length > 0 && 
                   currentState.playConfig.orderQuantityPerVideo > 0;
            } else if (service === 'like') {
                canSubmit = currentState.likeConfig.videoIds.length > 0 && 
                           currentState.likeConfig.likeCountPerVideo > 0;
            } else if (service === 'comment') {
                canSubmit = currentState.commentConfig.videoIds.length > 0 && 
                           currentState.commentConfig.commentCountPerVideo > 0 &&
                           currentState.commentConfig.commentTemplates.length > 0;
            } else if (service === 'follow') {
                canSubmit = currentState.followConfig.targetUsers.length > 0 && 
                           currentState.followConfig.messageContent.length > 0;
            }

            btn.disabled = !canSubmit;
        }

        // æ˜¾ç¤ºç¡®è®¤æ¨¡æ€æ¡†
        function showConfirmModal() {
            const service = currentState.selectedService;
            const unitPrice = currentState.servicePrices[service] || 0;

            // è®¡ç®—è¯¦ç»†ä¿¡æ¯
            let detailText = '';
            let totalTasks = 0;
            let total = 0;

            if (service === 'play') {
                const videoCount = currentState.playConfig.videoIds.length;
                const orderQuantityPerVideo = currentState.playConfig.orderQuantityPerVideo;
                const playCountPerVideo = orderQuantityPerVideo * 1000;
                totalTasks = videoCount * playCountPerVideo;
                detailText = `${videoCount} ä¸ªè§†é¢‘ Ã— ${orderQuantityPerVideo} å•ï¼ˆæ¯å•1000æ¬¡æ’­æ”¾ï¼‰ = ${totalTasks} æ¬¡æ’­æ”¾`;
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'like') {
                const videoCount = currentState.likeConfig.videoIds.length;
                const likeCountPerVideo = currentState.likeConfig.likeCountPerVideo;
                totalTasks = videoCount * likeCountPerVideo;
                detailText = `${videoCount} ä¸ªè§†é¢‘ Ã— ${likeCountPerVideo} ä¸ªç‚¹èµ = ${totalTasks} ä¸ªç‚¹èµ`;
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'comment') {
                const videoCount = currentState.commentConfig.videoIds.length;
                const commentCountPerVideo = currentState.commentConfig.commentCountPerVideo;
                totalTasks = videoCount * commentCountPerVideo;
                detailText = `${videoCount} ä¸ªè§†é¢‘ Ã— ${commentCountPerVideo} æ¡è¯„è®º = ${totalTasks} æ¡è¯„è®º`;
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'follow') {
                const userCount = currentState.followConfig.targetUsers.length;
                totalTasks = userCount;
                detailText = `${userCount} ä¸ªç”¨æˆ·`;
                total = (totalTasks / 1000) * unitPrice;
            }

            document.getElementById('confirmService').textContent = SERVICE_TYPES[service].name;
            document.getElementById('confirmUrl').textContent = detailText;
            document.getElementById('confirmQuantity').textContent = detailText;
            document.getElementById('confirmUnitPrice').textContent = `${unitPrice} USDT/${SERVICE_TYPES[service].unit}`;
            document.getElementById('confirmTotal').textContent = `${total.toFixed(2)} USDT`;

            document.getElementById('confirmModal').classList.add('show');
        }

        // éšè—ç¡®è®¤æ¨¡æ€æ¡†
        function hideConfirmModal() {
            document.getElementById('confirmModal').classList.remove('show');
        }

        // æäº¤è®¢å•
        async function submitOrder() {
            const cardKey = document.getElementById('cardKey').value.trim();
            
            if (!cardKey) {
                alert('è¯·è¾“å…¥å¡å¯†');
                return;
            }

            // ä¿å­˜å¡å¯†
            setCardKey(cardKey);

            const btn = document.getElementById('confirmOrderBtn');
            btn.disabled = true;
            btn.textContent = 'æäº¤ä¸­...';

            try {
                const service = currentState.selectedService;
                let orderData = {
                    service_type: service,
                    remark: currentState.remark,
                    card_key: cardKey
                };

                // æ ¹æ®æœåŠ¡ç±»å‹æ·»åŠ ç‰¹å®šé…ç½®
                if (service === 'play') {
                    orderData.video_ids = currentState.playConfig.videoIds;
            const orderQuantityPerVideo = currentState.playConfig.orderQuantityPerVideo;
            orderData.play_count_per_video = orderQuantityPerVideo * 1000;
            orderData.total_tasks = currentState.playConfig.videoIds.length * orderData.play_count_per_video;
                } else if (service === 'like') {
                    orderData.video_ids = currentState.likeConfig.videoIds;
                    orderData.like_count_per_video = currentState.likeConfig.likeCountPerVideo;
                    orderData.total_tasks = currentState.likeConfig.videoIds.length * currentState.likeConfig.likeCountPerVideo;
                } else if (service === 'comment') {
                    orderData.video_ids = currentState.commentConfig.videoIds;
                    orderData.comment_count_per_video = currentState.commentConfig.commentCountPerVideo;
                    orderData.comment_templates = currentState.commentConfig.commentTemplates;
                    orderData.add_emoji = currentState.commentConfig.addEmoji;
                    orderData.total_tasks = currentState.commentConfig.videoIds.length * currentState.commentConfig.commentCountPerVideo;
                } else if (service === 'follow') {
                    orderData.target_users = currentState.followConfig.targetUsers;
                    orderData.message_content = currentState.followConfig.messageContent;
                    orderData.add_random_emoji = currentState.followConfig.addRandomEmoji;
                    orderData.custom_emojis = currentState.followConfig.customEmojis;
                    orderData.total_tasks = currentState.followConfig.targetUsers.length;
                }

                const response = await fetch(`${API_BASE_URL}/order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(orderData)
                });

                const result = await response.json();

                if (result.code === 0) {
                    // ä¸‹å•æˆåŠŸ
                    hideConfirmModal();
                    showSuccessModal(result.data);
                } else {
                    alert(`ä¸‹å•å¤±è´¥: ${result.msg}`);
                }
            } catch (error) {
                console.error('ä¸‹å•å¤±è´¥:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ç¡®è®¤ä¸‹å•';
            }
        }

        // æ˜¾ç¤ºæˆåŠŸæ¨¡æ€æ¡†
        function showSuccessModal(orderData) {
            const service = currentState.selectedService;
            const unitPrice = currentState.servicePrices[service] || 0;

            let quantityText = '';
            let totalTasks = orderData.total_tasks || 0;
            let total = 0;

            if (service === 'play') {
                const videoCount = currentState.playConfig.videoIds.length;
                const orderQuantityPerVideo = currentState.playConfig.orderQuantityPerVideo;
                quantityText = `${videoCount} ä¸ªè§†é¢‘ Ã— ${orderQuantityPerVideo} å•ï¼ˆæ¯å•1000æ¬¡æ’­æ”¾ï¼‰ = ${totalTasks} æ¬¡æ’­æ”¾`;
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'like') {
                quantityText = `${currentState.likeConfig.videoIds.length} ä¸ªè§†é¢‘ï¼Œå…± ${totalTasks} ä¸ªç‚¹èµ`;
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'comment') {
                quantityText = `${currentState.commentConfig.videoIds.length} ä¸ªè§†é¢‘ï¼Œå…± ${totalTasks} æ¡è¯„è®º`;
                total = (totalTasks / 1000) * unitPrice;
            } else if (service === 'follow') {
                quantityText = `${currentState.followConfig.targetUsers.length} ä¸ªç”¨æˆ·`;
                total = (totalTasks / 1000) * unitPrice;
            }

            document.getElementById('successOrderId').textContent = orderData.order_id || orderData.id || 'N/A';
            document.getElementById('successService').textContent = SERVICE_TYPES[service].name;
            document.getElementById('successQuantity').textContent = quantityText;
            document.getElementById('successAmount').textContent = `${total.toFixed(2)} USDT`;

            document.getElementById('successModal').classList.add('show');
        }

        // éšè—æˆåŠŸæ¨¡æ€æ¡†
        function hideSuccessModal() {
            document.getElementById('successModal').classList.remove('show');
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            currentState.selectedService = null;
            currentState.remark = '';
            
            // é‡ç½®æ’­æ”¾é…ç½®
            currentState.playConfig = {
                videoIds: [],
        orderQuantityPerVideo: 1
            };
            
            // é‡ç½®ç‚¹èµé…ç½®
            currentState.likeConfig = {
                videoIds: [],
                likeCountPerVideo: 1000
            };
            
            // é‡ç½®è¯„è®ºé…ç½®
            currentState.commentConfig = {
                videoIds: [],
                commentCountPerVideo: 1000,
                commentTemplates: [],
                addEmoji: true
            };
            
            // é‡ç½®ç§ä¿¡é…ç½®
            currentState.followConfig = {
                targetUsers: [],
                messageContent: '',
                addRandomEmoji: true,
                customEmojis: []
            };

            document.querySelectorAll('.service-card').forEach(card => {
                card.classList.remove('selected');
            });

            // é‡ç½®æ–‡ä»¶è¾“å…¥
            document.getElementById('videoIdsFile').value = '';
            document.getElementById('videoIdsInput').value = '';
    document.getElementById('playCountPerVideo').value = 1;
            
            document.getElementById('likeVideoIdsFile').value = '';
            document.getElementById('likeVideoIdsInput').value = '';
            document.getElementById('likeCountPerVideo').value = 1000;
            
            document.getElementById('commentVideoIdsFile').value = '';
            document.getElementById('commentVideoIdsInput').value = '';
            document.getElementById('commentCountPerVideo').value = 1000;
            document.getElementById('commentTemplatesFile').value = '';
            document.getElementById('commentTemplatesInput').value = '';
            document.getElementById('commentAddEmoji').checked = true;
            
            document.getElementById('targetUsersFile').value = '';
            document.getElementById('targetUsersInput').value = '';
            document.getElementById('messageContent').value = '';
            document.getElementById('messageAddRandomEmoji').checked = true;
            document.getElementById('messageEmojis').value = '';
            
            document.getElementById('remark').value = '';

            // éšè—æ‰€æœ‰é…ç½®åŒºåŸŸ
            document.getElementById('playConfig').style.display = 'none';
            document.getElementById('likeConfig').style.display = 'none';
            document.getElementById('commentConfig').style.display = 'none';
            document.getElementById('followConfig').style.display = 'none';

            updateSummary();
        }

        // æ˜¾ç¤ºä¸»é¡µ
        function showMainPage() {
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('progressPage').classList.add('hidden');
        }

        // æ˜¾ç¤ºè¿›åº¦é¡µé¢
        async function showProgressPage() {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('progressPage').classList.remove('hidden');

            await loadOrders();
        }

        // åŠ è½½è®¢å•åˆ—è¡¨
        async function loadOrders() {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '<div class="loading-spinner"></div>';

            try {
                const cardKey = currentState.cardKey;
                const response = await fetch(`${API_BASE_URL}/orders?card_key=${encodeURIComponent(cardKey)}`);
                const result = await response.json();

                if (result.code === 0) {
                    const orders = result.data || [];
                    
                    if (orders.length === 0) {
                        orderList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">æš‚æ— è®¢å•</p>';
                        return;
                    }

                    orderList.innerHTML = '';
                    orders.forEach(order => {
                        const orderItem = createOrderItem(order);
                        orderList.appendChild(orderItem);
                    });

                    // å®šæ—¶åˆ·æ–°è¿›åº¦
                    setTimeout(loadOrders, 5000); // æ¯5ç§’åˆ·æ–°ä¸€æ¬¡
                } else {
                    orderList.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">åŠ è½½å¤±è´¥: ${result.msg}</p>`;
                }
            } catch (error) {
                console.error('åŠ è½½è®¢å•å¤±è´¥:', error);
                orderList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</p>';
            }
        }

        // åˆ›å»ºè®¢å•é¡¹
        function createOrderItem(order) {
            const div = document.createElement('div');
            div.className = 'order-item';

            const statusClass = getStatusClass(order.status);
            const statusText = getStatusText(order.status);
            const progress = order.complete_num / order.order_num * 100;

            div.innerHTML = `
                <div class="order-item-header">
                    <div class="order-item-title">
                        è®¢å• #${order.id} - ${SERVICE_TYPES[order.service_type]?.name || order.service_type}
                    </div>
                    <span class="order-status ${statusClass}">${statusText}</span>
                </div>
                <div class="order-info-row" style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    <span>ä¸‹å•æ—¶é—´: ${order.created_at || 'N/A'}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" style="width: ${progress}%"></div>
                </div>
                <div class="progress-text">
                    ${order.complete_num} / ${order.order_num} (${progress.toFixed(1)}%)
                </div>
            `;

            return div;
        }

        // è·å–çŠ¶æ€ç±»å
        function getStatusClass(status) {
            const statusMap = {
                0: 'pending',
                1: 'processing',
                2: 'completed'
            };
            return statusMap[status] || 'pending';
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                0: 'å¾…å¤„ç†',
                1: 'å¤„ç†ä¸­',
                2: 'å·²å®Œæˆ'
            };
            return statusMap[status] || 'æœªçŸ¥';
        }

        function formatQuota(value) {
            const num = Number(value) || 0;
            return num.toFixed(2);
        }

        function updateCardStatsDisplay(stats) {
            if (!stats) {
                return;
            }

            document.getElementById('cardCompletedOrders').textContent = stats.completed_orders || '0';
            document.getElementById('cardUsedQuota').textContent = `${formatQuota(stats.used_quota)} USDT`;
            document.getElementById('cardRemainingQuota').textContent = `${formatQuota(stats.remaining_quota)} USDT`;
            document.getElementById('cardStatsSection').style.display = 'block';
        }

        function renderCardQueryStats(stats) {
            const statsContainer = document.getElementById('cardQueryStats');

            if (!stats) {
                statsContainer.innerHTML = '<p class="card-query-placeholder">æœªè·å–åˆ°å¡å¯†ç»Ÿè®¡æ•°æ®</p>';
                return;
            }

            statsContainer.innerHTML = `
                <div class="card-query-stat">
                    <div class="label">å‰©ä½™ç§¯åˆ†</div>
                    <div class="value">${formatQuota(stats.remaining_quota)}</div>
                </div>
                <div class="card-query-stat">
                    <div class="label">å·²ä½¿ç”¨ç§¯åˆ†</div>
                    <div class="value">${formatQuota(stats.used_quota)}</div>
                </div>
                <div class="card-query-stat">
                    <div class="label">å·²å®Œæˆè®¢å•</div>
                    <div class="value">${stats.completed_orders || 0}</div>
                </div>
            `;
        }

        function renderCardQueryOrders(orders) {
            const container = document.getElementById('cardQueryOrdersList');

            if (!orders || orders.length === 0) {
                container.innerHTML = '<p class="card-query-placeholder">è¯¥å¡å¯†å°šæœªäº§ç”Ÿè®¢å•</p>';
                return;
            }

            container.innerHTML = '';
            const list = orders.slice(0, 10);

            list.forEach(order => {
                const row = document.createElement('div');
                row.className = 'card-order-row';

                const statusClass = getStatusClass(order.status);
                const statusText = getStatusText(order.status);

                row.innerHTML = `
                    <div>
                        <div class="card-order-title">è®¢å• #${order.id} Â· ${SERVICE_TYPES[order.service_type]?.name || order.service_type}</div>
                        <div class="card-order-meta">
                            æ•°é‡ï¼š${order.order_num || 0} ï½œ å®Œæˆï¼š${order.complete_num || 0} ï½œ ä¸‹å•æ—¶é—´ï¼š${order.created_at || 'N/A'}
                        </div>
                    </div>
                    <span class="order-status ${statusClass}">${statusText}</span>
                `;

                container.appendChild(row);
            });

            if (orders.length > list.length) {
                const tip = document.createElement('p');
                tip.className = 'card-query-placeholder';
                tip.textContent = `ä»…æ˜¾ç¤ºæœ€è¿‘ ${list.length} æ¡ï¼Œå…± ${orders.length} æ¡è®¢å•`;
                container.appendChild(tip);
            }
        }

        // åˆ·æ–°å¡å¯†ç»Ÿè®¡
        async function refreshCardStats() {
            const cardKey = currentState.cardKey;
            
            if (!cardKey) {
                alert('è¯·å…ˆè¾“å…¥å¡å¯†');
                return;
            }

            try {
                // è°ƒç”¨APIè·å–å¡å¯†ç»Ÿè®¡ä¿¡æ¯
                const response = await fetch(`${API_BASE_URL}/card/stats?card_key=${encodeURIComponent(cardKey)}`);
                const result = await response.json();

                if (result.code === 0) {
                    updateCardStatsDisplay(result.data || {});
                } else {
                    alert(`è·å–å¡å¯†ç»Ÿè®¡å¤±è´¥: ${result.msg}`);
                }
            } catch (error) {
                console.error('è·å–å¡å¯†ç»Ÿè®¡å¤±è´¥:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }

        // æ ¹æ®è®¢å•å·æŸ¥è¯¢è®¢å•
        async function searchOrderById() {
            const orderId = document.getElementById('searchOrderId').value.trim();
            
            if (!orderId) {
                alert('è¯·è¾“å…¥è®¢å•å·');
                return;
            }

            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '<div class="loading-spinner"></div>';

            try {
                const response = await fetch(`${API_BASE_URL}/order/${encodeURIComponent(orderId)}`);
                const result = await response.json();

                if (result.code === 0) {
                    const order = result.data;
                    
                    if (!order) {
                        orderList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">æœªæ‰¾åˆ°è¯¥è®¢å•</p>';
                        return;
                    }

                    orderList.innerHTML = '';
                    const orderItem = createOrderItem(order);
                    orderList.appendChild(orderItem);
                } else {
                    orderList.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">æŸ¥è¯¢å¤±è´¥: ${result.msg}</p>`;
                }
            } catch (error) {
                console.error('æŸ¥è¯¢è®¢å•å¤±è´¥:', error);
                orderList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</p>';
            }
        }

        // åŠ è½½æ‰€æœ‰è®¢å•ï¼ˆä½¿ç”¨å¡å¯†ï¼‰
        async function loadAllOrders() {
            const cardKey = currentState.cardKey;
            
            if (!cardKey) {
                alert('è¯·å…ˆè¾“å…¥å¡å¯†');
                return;
            }

            await loadOrders();
        }

        async function queryCardInfo() {
            const queryInput = document.getElementById('cardQueryInput');
            let cardKey = queryInput.value.trim();

            if (!cardKey) {
                cardKey = document.getElementById('cardKey').value.trim() || currentState.cardKey;
            }

            if (!cardKey) {
                alert('è¯·è¾“å…¥å¡å¯†');
                return;
            }

            const resultContainer = document.getElementById('cardQueryResult');
            const statsContainer = document.getElementById('cardQueryStats');
            const ordersContainer = document.getElementById('cardQueryOrdersList');

            resultContainer.classList.remove('hidden');
            statsContainer.innerHTML = '<div class="loading-spinner" style="width: 40px; height: 40px; margin: 10px auto;"></div>';
            ordersContainer.innerHTML = '<div class="loading-spinner" style="width: 40px; height: 40px; margin: 10px auto;"></div>';

            try {
                const [statsResponse, ordersResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/card/stats?card_key=${encodeURIComponent(cardKey)}`),
                    fetch(`${API_BASE_URL}/orders?card_key=${encodeURIComponent(cardKey)}`)
                ]);

                const statsResult = await statsResponse.json();
                const ordersResult = await ordersResponse.json();

                if (statsResult.code === 0) {
                    const stats = statsResult.data || {};
                    renderCardQueryStats(stats);
                    updateCardStatsDisplay(stats);
                } else {
                    statsContainer.innerHTML = `<p class="card-query-placeholder">è·å–å¡å¯†ç»Ÿè®¡å¤±è´¥ï¼š${statsResult.msg}</p>`;
                }

                if (ordersResult.code === 0) {
                    renderCardQueryOrders(ordersResult.data || []);
                } else {
                    ordersContainer.innerHTML = `<p class="card-query-placeholder">è·å–è®¢å•å¤±è´¥ï¼š${ordersResult.msg}</p>`;
                }

                setCardKey(cardKey);
            } catch (error) {
                console.error('æŸ¥è¯¢å¡å¯†ä¿¡æ¯å¤±è´¥:', error);
                statsContainer.innerHTML = '<p class="card-query-placeholder">è·å–å¡å¯†ç»Ÿè®¡æ•°æ®å¤±è´¥</p>';
                ordersContainer.innerHTML = '<p class="card-query-placeholder">è·å–è®¢å•åˆ—è¡¨å¤±è´¥</p>';
            }
        }

        // ç›‘å¬å¡å¯†è¾“å…¥å˜åŒ–
        document.getElementById('cardKey').addEventListener('change', async (e) => {
            const cardKey = e.target.value.trim();
            if (cardKey) {
                setCardKey(cardKey);
                
                // è‡ªåŠ¨åŠ è½½å¡å¯†ç»Ÿè®¡
                await refreshCardStats();
            }
        });

        // ç›‘å¬è®¢å•å·è¾“å…¥æ¡†çš„å›è½¦é”®
        document.getElementById('searchOrderId').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchOrderById();
            }
        });

        // é¡µé¢åŠ è½½æ—¶ï¼Œå¦‚æœæœ‰å¡å¯†åˆ™è‡ªåŠ¨åŠ è½½ç»Ÿè®¡
        window.addEventListener('DOMContentLoaded', () => {
            if (currentState.cardKey) {
                refreshCardStats();
            }
        });
    </script>
</body>
</html>

